# Ren'Py å¯¹è¯å¯¼å…¥å·¥å…·

ä¸€ä¸ªç”¨äºä» `.tab` è¡¨æ ¼ä¸­æ‰¹é‡æ›´æ–°æ¸¸æˆè„šæœ¬ã€æ·»åŠ è¯­éŸ³ã€æ›´æ–°ç¿»è¯‘æ ‡è¯†ç¬¦çš„å°å·¥å…·
ç®€å•æ¥è¯´å°±æ˜¯é”™åˆ«å­—æ›´æ–°å™¨ï¼Œæœ€é€‚ç”¨çš„åœºæ™¯æ˜¯æ¸¸æˆæ¼”å‡ºç¼–å†™ä¸ç¿»è¯‘å·¥ä½œéƒ½å®Œæˆäº†ç»“æœå›å¤´å‘ç°ä¸€å¤§å †é”™åˆ«å­—æ—¶æ—¶éœ€è¦ç»æœ›åœ°æŒ¨ä¸ªå„¿ä¿®æ”¹çš„æ—¶å€™ã€‚

~~ä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆè¦æ“è¿™ä¸ª~~

## åŠŸèƒ½ç‰¹ç‚¹

- **ğŸ“ æ›´æ–°å‰§æƒ…æ–‡æœ¬**ï¼šæ ¹æ® `.tab` è¡¨æ ¼é‡Œçš„ `Identifier`æ›¿æ¢ `.rpy` è„šæœ¬é‡Œå¯¹åº”çš„å¯¹è¯å†…å®¹ã€‚ä¸ç”¨è¡Œå·åŒ¹é…ã€‚ä½†æ³¨æ„ä¸èƒ½å¢åˆ è¡Œï¼Œä¸”å¿…é¡»ä¿è¯ä½ ç”¨çš„ `.tab` è¡¨æ ¼æ˜¯æœ€æ–°çš„ï¼ˆå¯¼å‡ºè¡¨æ ¼åè¦æ˜¯æ”¹äº†è„šæœ¬æ–‡æœ¬ï¼Œä¼šå¯¼è‡´ä¿®æ”¹çš„è„šæœ¬æ–‡ä»¶ä¸­çš„Identifierå˜æ›´ï¼Œå› æ­¤å°±ä¼š`.tab`æ–‡ä»¶å¯¹ä¸ä¸Šäº†

- **ğŸµ æ’å…¥è¯­éŸ³æ ‡è®°**ï¼šè‡ªåŠ¨æ·»åŠ  `voice "file.ogg"` è¡Œï¼Œåœ¨è¡¨æ ¼é‡Œæ–°å»ºä¸€åˆ—ï¼Œè¡¨å¤´å†™ä¸Š `"voice"`ï¼Œä¸‹é¢å¡«å¥½æ–‡ä»¶åï¼ˆä¸ç”¨åŠ å¼•å·ï¼‰ã€‚è¿è¡Œå·¥å…·æ—¶å‹¾é€‰é€‰é¡¹ï¼Œå°±èƒ½æ‰¹é‡åœ¨å¯¹è¯å‰æ’å…¥è¯­éŸ³ä»£ç ã€‚é€‚åˆåªæœ‰é›¶æ˜Ÿå‡ å¥è¯­éŸ³ï¼Œæˆ–è€…å¤§é‡å¤ç”¨åŒä¸€è¯­éŸ³çš„æƒ…å†µã€‚å¦‚æœä½ æœ‰å®Œæ•´å¤šè¯­è¨€é…éŸ³ï¼Œ**å°±æ²¡æœ‰å¿…è¦ä½¿ç”¨è¿™ä¸ªäº†ï¼**ï¼å®˜æ–¹è‡ªå¸¦çš„è‡ªåŠ¨åŒ¹é…æ›´é¦™XD
  
- **ğŸ†” æ›´æ–°æ ‡è¯†ç¬¦**ï¼šä¿®æ”¹æ–‡æœ¬åï¼Œè¯­å¥çš„ `Identifier` ä¼šå˜ã€‚è¿™ä¸ªåŠŸèƒ½èƒ½æŠŠæ–°çš„ `Identifier` å†™å›ä½ çš„ `.tab` è¡¨æ ¼é‡Œï¼Œæ–¹ä¾¿ä½ ä¸‹è½®ç»§ç»­ç¼–è¾‘ã€‚
  
- **ğŸŒ æ›´æ–°ç¿»è¯‘æ–‡ä»¶**ï¼šå½“ `Identifier` å˜äº†ï¼Œæ—§çš„ç¿»è¯‘å°±ä¼šå¤±æ•ˆã€‚è¿™ä¸ªåŠŸèƒ½ä¼šåŒæ­¥æ›´æ–°ç¿»è¯‘æ–‡ä»¶é‡Œçš„ `Identifier`ï¼Œå¹¶è´´å¿ƒåœ°åŠ ä¸€å¥ `#ç¿»è¯‘å¾…æ›´æ–°` æ³¨é‡Šï¼Œå¸®ä½ å¿«é€Ÿå®šä½å“ªäº›ç¿»è¯‘éœ€è¦è¿”å·¥ï¼ˆé¡ºä¾¿è¿˜ä¼šæ ‡è®°ä¿®æ”¹æ¬¡æ•°ï¼Œè·‘äº†å‡ éå°±ä¼šxå‡ ï¼Œç”¨æ¥è®¡ç®—åˆ°åº•ä¿®äº†å¤šå°‘æ¬¡ï¼ˆè‰
  
- **ğŸ”¤ å¤šç¼–ç æ”¯æŒ**ï¼šæ”¯æŒ UTF-8 å’Œ GBK ç¼–ç çš„æ–‡ä»¶ï¼ˆtmdï¼Œä¸€ç”¨excelç¼–è¾‘tabè¡¨æ ¼å°±ä¼šå¼ºåˆ¶å˜æˆgbkç¼–ç è¡¨ï¼

## æ€ä¹ˆç”¨ï¼Ÿ

### 1. å®‰è£…å·¥å…·
1. ä¸‹è½½ `input_dialogue.rpy` å’Œ `schinese.rpy`ã€‚
    - `input_dialogue.rpy` æ˜¯åŠŸèƒ½ä»£ç ã€‚
    - `schinese.rpy` æ˜¯ä¸­æ–‡ç¿»è¯‘ã€‚
2. æŠŠ `input_dialogue.rpy` æ”¾è¿› `ä½ çš„é¡¹ç›®/renpy/launcher/game/` ä¸­ã€‚
3. æŠŠ `schinese.rpy` æ”¾è¿› `ä½ çš„é¡¹ç›®/renpy/launcher/game/tl/schinese/` ä¸­ã€‚


### 2. æ·»åŠ å…¥å£
æ‰“å¼€ `ä½ çš„é¡¹ç›®/renpy/launcher/game/front_page.rpy`ï¼Œæ‰¾åˆ°ç±»ä¼¼ä¸‹é¢çš„ä»£ç å—ï¼š
```rpy
textbutton _("Force Recompile") action Jump("force_recompile")
```
åœ¨å®ƒä¸‹é¢æ·»åŠ ä¸€è¡Œï¼š
```rpy
textbutton _("Import Dialogue") action Jump("import_dialogue")
```
ç°åœ¨æ‰“å¼€ Ren'Py å¯åŠ¨å™¨ï¼Œå°±èƒ½åœ¨åˆ—è¡¨ä¸­çœ‹åˆ°â€œ**æ‰¹é‡æ›´æ–°å¯¹è¯**â€çš„å…¥å£äº†ï¼


### 3. å‡†å¤‡ `.tab` æ–‡ä»¶
è¯·ä½¿ç”¨ Ren'Py è‡ªå¸¦çš„â€œ**æå–å¯¹è¯**â€åŠŸèƒ½æ¥è·å– `.tab` æ–‡ä»¶ã€‚

**æå–æ—¶åŠ¡å¿…æ³¨æ„ï¼š**
1.  é€‰æ‹©â€œ**ä»¥åˆ¶è¡¨ç¬¦åˆ†éš”çš„è¡¨æ ¼ (dialogue.tab)**â€ã€‚
2.  **ä¸è¦å‹¾é€‰**å¦å¤–ä¸‰ä¸ªé€‰é¡¹ï¼ˆå¦åˆ™æå–çš„å†…å®¹ä¼šæ²¡æœ‰ texttagï¼Œä¸€è¦†ç›–ä½ çš„texttagä¹Ÿå°±æ²¡äº†ï¼‰ã€‚
3.  é»˜è®¤è¯­è¨€å¡« `None`ã€‚

ä½ çš„è¡¨æ ¼æ–‡ä»¶åº”è‡³å°‘åŒ…å«ä»¥ä¸‹åˆ—ï¼š
- `identifier` â€“ æ¯è¡Œçš„å”¯ä¸€æ ‡è¯†ç¬¦
- `filename` â€“ `.rpy` æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„
- `character` â€“ è§’è‰²åï¼ˆå¯é€‰ï¼‰
- `dialogue` â€“ å¯¹è¯æ–‡æœ¬
- `line number` â€“ è„šæœ¬ä¸­çš„è¡Œå·

**å¯é€‰åˆ—ï¼š**
- `voice` â€“ è¯­éŸ³æ–‡ä»¶åï¼ˆä¾‹å¦‚ `voice_01`ï¼‰


### 4. è¿è¡Œå·¥å…·
1.  æ‰“å¼€ Ren'Py å¯åŠ¨å™¨ã€‚
2.  é€‰æ‹©ä½ çš„é¡¹ç›®ã€‚
3.  ç‚¹å‡»â€œ**æ‰¹é‡æ›´æ–°å¯¹è¯**â€ã€‚
4.  é€‰æ‹©ä½ çš„ `.tab` æ–‡ä»¶å¹¶å‹¾é€‰éœ€è¦çš„å¤„ç†é€‰é¡¹ã€‚
5.  **å¤‡ä»½å¤‡ä»½å¤‡ä»½ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼**
6.  ç‚¹å‡» **å¤„ç†æ–‡ä»¶**ï¼Œç¥ˆç¥·å§ï¼ 


## é€‰é¡¹è¯´æ˜ä¹¦

| é€‰é¡¹ | è¯´æ˜ |
|------|------|
| **æ›´æ–°æ–‡æœ¬å†…å®¹** | å°† TAB è¡¨ä¸­çš„æ–‡æœ¬æ›¿æ¢åˆ° `.rpy` æ–‡ä»¶é‡Œå¯¹åº” Identifier çš„æ–‡æœ¬ä¸Šã€‚ |
| **æ’å…¥è¯­éŸ³æ ‡è®°** | åœ¨å¯¹è¯è¡Œä¸Šæ–¹æ’å…¥ `voice "voice_01"` è¡Œã€‚ |
| **æ›´æ–°å¯¹è¯æ ‡è¯†ç¬¦** | å¦‚æœæ›´æ–°æ–‡æœ¬å Identifier å˜äº†ï¼ŒæŠŠæ–° Identifier å†™å›ä½ çš„ `.tab` æ–‡ä»¶é‡Œã€‚ |
| **æ›´æ–°ç¿»è¯‘å­—ç¬¦ä¸²** | å¦‚æœ Identifier å˜äº†ï¼ŒåŒæ­¥æ›´æ–°ç¿»è¯‘æ–‡ä»¶é‡Œçš„ Identifier å¹¶æ·»åŠ æ³¨é‡Šã€‚ |


## è¦æ±‚

- Ren'Py 7.4.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- ä¸€ä¸ªå·²ç»é€šè¿‡â€œæå–å¯¹è¯â€åŠŸèƒ½å¤„ç†è¿‡çš„ Ren'Py é¡¹ç›®


## âš ï¸ é‡è¦è­¦å‘Šï¼

- **è¿è¡Œå·¥å…·å‰åŠ¡å¿…å¤‡ä»½ä½ çš„é¡¹ç›®ï¼åˆ‡è®°ï¼ï¼ï¼ï¼**
- å·¥å…·ä¼šä¸ºä¿®æ”¹çš„æ–‡ä»¶åˆ›å»º `.bak` å¤‡ä»½æ–‡ä»¶ã€‚
- å¦‚æœæ›´æ–°æ ‡è¯†ç¬¦ï¼Œç¿»è¯‘æ–‡ä»¶ä¼šåŒæ­¥æ›´æ–°å¹¶æ·»åŠ è­¦å‘Šæ³¨é‡Šã€‚
- **å…³äºè§’è‰²ååˆ¤æ–­**ï¼šè¿™ä¸ªå·¥å…·æ˜¯åœ¨ä¸­æ–‡ç¯å¢ƒä¸‹è¯ç”Ÿçš„ï¼Œæ‰€ä»¥å®ƒåˆ¤æ–­ `character` åˆ—æ˜¯å˜é‡è¿˜æ˜¯ä¸´æ—¶å­—ç¬¦ä¸²çš„æ–¹æ³•å¾ˆç®€å•ç²—æš´â€”â€”**çœ‹é‡Œé¢æœ‰æ²¡æœ‰ä¸­æ–‡**ï¼å¦‚æœæ²¡æœ‰ä¸­æ–‡ï¼Œå°±è®¤ä¸ºæ˜¯å®šä¹‰å¥½çš„è§’è‰²å˜é‡åï¼ˆè‰ç‡ä½†æœ‰æ•ˆ.jpgï¼‰ã€‚

---

# Ren'Py Tab Importer Tool

A lifesaver tool to pull you out of the despair of typo hell! It's designed for batch updating game scripts from `.tab` files, adding voice lines, and updating translation identifiers.

In short, this is your "I regret everything" button. It's most useful in that nightmare scenario where all the game acting and translation are done, you look backâ€”**"Oh crap, a bunch of typos!"**â€”and face the despair of fixing them one by one.
~~Don't ask me why I felt the need~~

## What Can It Do?

- **ğŸ“ Update Story Text**: Precisely replaces dialogue text in `.rpy` scripts based on the `Identifier` in the `.tab` file. No line number matching needed! But note: You cannot add or delete lines, and you MUST use the latest `.tab` file (if you modify the script text after exporting the table, the Identifier won't match and it will fail for that line!).
  
- **ğŸµ Insert Voice Tags**: Automatically adds `voice "file.ogg"` lines! Create a new column in your table named `"voice"`, fill in the filenames (without quotes). Check the option when running the tool to batch insert voice code before dialogues. Perfect for projects with just a few voice lines or heavy voice reuse. **Do NOT use this** if you have full multi-language voiceovers! The official automatic matching is better.
  
- **ğŸ†” Update Identifiers**: Modifying text changes the statement's `Identifier`. This feature writes the new `Identifier` back to your `.tab` file, making the next round of editing easier.
  
- **ğŸŒ Update Translation Files**: When the `Identifier` changes, old translations break. This feature synchronizes the new `Identifier` into the translation files and kindly adds a `# Translation needs update` comment, helping you quickly locate which translations need work (It also marks how many times it's been modifiedâ€”an 'x' followed by the countâ€”so you know exactly how much you've been messing around ğŸ˜‚).
  
- **ğŸ”¤ Multi-Encoding Support**: Handles files in both UTF-8 and GBK encodings (**Darn it, Excel always forces `.tab` files into GBK!**).

## How to Use?

### 1. Install the Tool
1. Download `input_dialogue.rpy` and `schinese.rpy`.
    - `input_dialogue.rpy` is the core functionality.
    - `schinese.rpy` is the Chinese translation (for the tool's UI).
2. Place `input_dialogue.rpy` into `YourProject/renpy/launcher/game/`.
3. Place `schinese.rpy` into `YourProject/renpy/launcher/game/tl/schinese/`.

### 2. Add the Entry Point
Open `YourProject/renpy/launcher/game/front_page.rpy`, find a code block like this:
```rpy
textbutton _("Force Recompile") action Jump("force_recompile")
```
Add this line right after it:
```rpy
textbutton _("Import Dialogue") action Jump("import_dialogue")
```
Now open the Ren'Py Launcher, and you'll see the "**Import Dialogue**" button in the list!

### 3. Prepare the `.tab` File
Use Ren'Py's built-in "**Extract Dialogue**" feature to get your `.tab` file.

**Extraction Notes (IMPORTANT):**
1.  Choose "**Tab-delimited Spreadsheet (dialogue.tab)**".
2.  **DO NOT check** the other three options (or the extracted content will lack texttags and fail to update).
3.  Set Default Language to `None`.

Your spreadsheet must at least contain these columns:
- `identifier` â€“ The unique identifier for each line
- `filename` â€“ The relative path to the `.rpy` file
- `character` â€“ The character's name (Optional)
- `dialogue` â€“ The dialogue text
- `line number` â€“ The line number in the script

**Optional Column:**
- `voice` â€“ The voice filename (e.g., `voice_01`)

### 4. Run the Tool
1.  Open the Ren'Py Launcher.
2.  Select your project.
3.  Click "**Import Dialogue**".
4.  Select your `.tab` file and choose the processing options you need.
5.  Click **Process Files** and pray! (Just kidding, but backup is highly recommended)

## Option Manual

| Option | Description |
|------|------|
| **Update Text Content** | Replaces the text in `.rpy` files for the corresponding Identifier with the text from the TAB file. |
| **Insert Voice Tags** | Inserts a `voice "voice_01"` line above the dialogue line. |
| **Update Dialogue Identifiers** | If the Identifier changes after updating text, writes the new Identifier back to your `.tab` file. |
| **Update Translation Strings** | If the Identifier changes, updates the Identifier in the translation file and adds a comment. |

## Requirements

- Ren'Py 7.4.0 or higher
- A Ren'Py project that has been processed with the "Extract Dialogue" feature

## âš ï¸ Important Warnings!

- **ALWAYS BACKUP YOUR PROJECT BEFORE RUNNING THIS TOOL! SERIOUSLY!!!!**
- The tool creates `.bak` backup files for modified files.
- If updating identifiers, translation files will be updated and get warning comments.
- **About Character Name Detection**: This tool was born in a Chinese environment, so its method to determine if the `character` column is a variable or a temporary string is simple and crudeâ€”**check if it contains Chinese characters**! If it doesn't, it's assumed to be a predefined character variable (Effective.jpg).

---
